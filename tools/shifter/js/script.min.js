(()=>{"use strict";const e=document.querySelector("#main"),t=document.querySelector("#add"),n=document.querySelector("#clone"),r=document.querySelector("#export"),l=document.querySelector("#number"),o=document.getElementById("add-text-to-selected"),c=new Date,d=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`,a=()=>{const e=document.getElementById("table"),t=e&&e.querySelectorAll("tr").length>0;n.disabled=!t},i=e=>document.querySelector(e).value,s=e=>{const t=document.getElementById(e);return 0===t.children.length&&""===t.textContent.trim()},m=(e,t="")=>{const n=document.createElement(e);return n.innerHTML=t,n},u=e=>{e.preventDefault(),e.currentTarget.classList.toggle("selected")},h=e=>{e.preventDefault(),e.currentTarget.innerText=i("#text")},x=function(){this.parentElement.remove(),l.disabled=!s("table"),a()};let g=0;const b=()=>{const e=i("#text"),t=Number(e[0]);return g+=t,g%t==0?1:0},p=e=>{const[,...t]=e.parentElement.children;return t.length-=3,t},E=function(){const e=p(this);if(e.length<2)return;const t=e[e.length-1].innerText;for(let t=e.length-1;t>0;t--)e[t].innerText=e[t-1].innerText;e[0].innerText=t},f=function(){const e=p(this);if(e.length<2)return;const t=e[0].innerText;for(let t=0;t<e.length-1;t++)e[t].innerText=e[t+1].innerText;e[e.length-1].innerText=t},k=(t,n)=>{let r=e.querySelector("table");r||(r=document.createElement("table"),r.id="table",r.cellPadding="0",r.cellSpacing="0",r.style.gridTemplateColumns=`repeat(${Number(t)+4}, minmax(20px, 1fr))`,e.appendChild(r));const l=document.createElement("tr"),o=document.createDocumentFragment(),c=m("td",(d=n)?d.charAt(0).toUpperCase()+d.slice(1):"");var d;c.addEventListener("dblclick",h),l.appendChild(c);const a=Number(t)>=28&&Number(t)<=31?Number(t):31,s=i("#text");for(let e=1;e<=a;e++){let t=e<10?`0${e}`:e;s.includes("+")?t=b():s&&(t=s);const n=m("td",t);n.align="center",n.addEventListener("click",u),n.addEventListener("dblclick",h),l.appendChild(n)}[{text:"remove",handler:x},{text:"<",handler:f},{text:">",handler:E}].forEach((({text:e,handler:t})=>{const n=m("td",e);n.id=e,n.addEventListener("click",t),l.appendChild(n)})),o.appendChild(l),r.appendChild(o)},v=(e,t)=>{e.nodeType||(e=document.getElementById(e));const n={worksheet:t||"Worksheet",table:(e=>(Array.from(e.rows).forEach((e=>{Array.from(e.cells).forEach((e=>{const t=getComputedStyle(e);if(["remove","<",">"].includes(e.textContent.toLowerCase()))return void e.remove();t.backgroundColor&&"rgba(0, 0, 0, 0)"!==t.backgroundColor&&e.setAttribute("bgcolor","#eee");const n=parseInt(t.width,10);!isNaN(n)&&n>0&&(e.setAttribute("width",n),e.style.width=`${n}px`)}))})),e))(e.cloneNode(!0)).innerHTML};var r;window.location.href="data:application/vnd.ms-excel;base64,"+(e=>{const t=(new TextEncoder).encode(e);return btoa(String.fromCharCode(...t))})((r=n,'\n    <html xmlns:o="urn:schemas-microsoft-com:office:office"\n    xmlns:x="urn:schemas-microsoft-com:office:excel"\n    xmlns="http://www.w3.org/TR/REC-html40">\n    <head>\n    \x3c!--[if gte mso 9]>\n    <xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>\n    <x:Name>{worksheet}</x:Name>\n    <x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions>\n    </x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml>\n    <![endif]--\x3e\n    <meta charset="UTF-8"/>\n    </head><body><table>{table}</table></body></html>'.replace(/{(\w+)}/g,((e,t)=>r[t]))))};o.addEventListener("click",(()=>{const t=e.querySelectorAll(".selected"),n=i("#text");t.forEach((e=>e.innerText=n))})),r.addEventListener("click",(()=>v("table"))),t.addEventListener("click",(()=>{const e=i("#number"),t=s("table")?d:i("#name");k(e,t),l.disabled=!0,a()})),n.addEventListener("click",(function(){const e=document.getElementById("table");if(!e)return;const t=e.getElementsByTagName("tr");if(!t.length)return;const n=t[t.length-1].cloneNode(!0);n.querySelectorAll("td").forEach((e=>{const t=e.textContent.trim().toLowerCase();["remove","<",">"].includes(t)||(e.addEventListener("click",u),e.addEventListener("dblclick",h)),"remove"===t?e.addEventListener("click",x):"<"===t?e.addEventListener("click",f):">"===t&&e.addEventListener("click",E)})),e.appendChild(n)})),""===e.innerHTML.trim()&&(k(i("#number"),d),l.disabled=!0)})();

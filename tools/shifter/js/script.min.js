(()=>{"use strict";const e=document.querySelector("#main"),t=document.querySelector("#add"),n=document.querySelector("#clone"),r=document.querySelector("#export"),o=document.querySelector("#number"),c=document.getElementById("add-text-to-selected"),l=document.getElementById("break"),a=document.querySelector("#text"),s=document.getElementById("output"),d=document.getElementById("sum-table"),i=new Date,m=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`,u=["C1","C2","C3","C4","C5"],h=()=>document.getElementById("table"),g=e=>document.querySelector(e)?.value??"",x=e=>{const t=document.getElementById(e);return t&&0===t.children.length&&""===t.textContent.trim()},p=(e,t="")=>{const n=document.createElement(e);return n.innerHTML=t,n},b=()=>{const e=h();n.disabled=!(e&&e.querySelectorAll("tr").length>0)},f=e=>{e.preventDefault();const t=a.value;y(e.currentTarget,t,l.checked)};const E=new class{constructor(e){this.namespace=e}setItem(e,t){localStorage.setItem(`${this.namespace}:${e}`,JSON.stringify(t))}getItem(e,t=null){const n=localStorage.getItem(`${this.namespace}:${e}`);return null!==n?JSON.parse(n):t}removeItem(e){localStorage.removeItem(`${this.namespace}:${e}`)}clear(){Object.keys(localStorage).filter((e=>e.startsWith(this.namespace+":"))).forEach((e=>localStorage.removeItem(e)))}}("table"),v=()=>{const e=h();if(!e)return;const t=Array.from(e.rows).map((e=>{const t=Array.from(e.cells),n=t.slice(0,-4).map((e=>({text:e.textContent,selected:e.classList.contains("selected")}))),r=t.slice(-4).map((e=>({text:e.textContent})));return n.concat(r)}));E.setItem("tableData",t)},y=(e,t,n=!1)=>{n&&!e.dataset.breakAdded?(e.innerHTML+="<br>"+t,e.dataset.breakAdded="true"):n||(e.innerHTML=t,e.dataset.breakAdded=""),A(),v()},k=e=>{e.preventDefault(),e.currentTarget.classList.toggle("selected"),A(),q(),v()},C=function(){const e=this.closest("tr");e&&(e.remove(),o.disabled=!x("table"),b(),A(),v())};let L=0;const S=()=>{const e=a.value,t=Number(e[0]);return L+=t,L%t==0?1:0},T=e=>{const[,...t]=e.parentElement.children;return t.length-=4,t},w=function(){const e=T(this);if(e.length<2)return;const t=e[e.length-1].innerText;for(let t=e.length-1;t>0;t--)e[t].innerText=e[t-1].innerText;e[0].innerText=t},I=function(){const e=T(this);if(e.length<2)return;const t=e[0].innerText;for(let t=0;t<e.length-1;t++)e[t].innerText=e[t+1].innerText;e[e.length-1].innerText=t},A=()=>{const e=h();e&&Array.from(e.rows).forEach((e=>{const t=e.querySelectorAll("td.selected").length,n=e.querySelector('td[data-control="count"]');n&&(n.textContent=t)}))},$=e=>{const t=document.getElementById(e.toUpperCase());return t&&parseFloat(t.value)||0},q=()=>{const e=h();if(!e)return;let t=0;const n={},r=e.querySelectorAll("td");for(let e=0;e<r.length;e++){const o=r[e].textContent.trim().toUpperCase();if(u.includes(o)){t+=$(o),n[o]=(n[o]||0)+1}}const o=Object.keys(n).map((e=>`${e} Ã— ${n[e]} = ${$(e)*n[e]}`)).join("\n");s.innerHTML=`\n    <div class="section-title">Variables Found:</div>\n    ${o||"None found"}\n\n    <div class="section-title">Total Sum:</div>\n    ${t}\n    `},N=(t,n)=>{let r=h();r||(r=document.createElement("table"),r.id="table",r.cellPadding="0",r.cellSpacing="0",e.appendChild(r));const o=document.createElement("tr"),c=document.createDocumentFragment(),l=p("td",(s=n)?s.charAt(0).toUpperCase()+s.slice(1):"");var s;l.addEventListener("dblclick",f),o.appendChild(l);const d=Number(t)>=28&&Number(t)<=31?Number(t):31,i=a.value;for(let e=1;e<=d;e++){let t=e<10?`0${e}`:e;i.includes("+")?t=S():i&&(t=i);const n=p("td",t);n.align="center",n.addEventListener("click",k),n.addEventListener("dblclick",f),o.appendChild(n)}[{text:"remove",control:"remove",handler:C},{text:"<",control:"prev",handler:I},{text:">",control:"next",handler:w},{text:"0",control:"count",handler:A}].forEach((({text:e,control:t,handler:n})=>{const r=p("td",e);r.dataset.control=t,r.addEventListener("click",n),o.appendChild(r)})),c.appendChild(o),r.appendChild(c)},B=(e,t)=>{e.nodeType||(e=document.getElementById(e));const n={worksheet:t||"Worksheet",table:(e=>(Array.from(e.rows).forEach((e=>{Array.from(e.cells).forEach((e=>{const t=e.textContent.trim().toLowerCase();["remove","<",">"].includes(t)?e.remove():(e.setAttribute("valign","top"),e.classList.contains("selected")&&e.setAttribute("bgcolor","#777777"),"count"===e.dataset.control&&e.setAttribute("bgcolor","#eeeeee"))}))})),e))(e.cloneNode(!0)).innerHTML};var r;window.location.href="data:application/vnd.ms-excel;base64,"+(e=>{const t=(new TextEncoder).encode(e);return btoa(String.fromCharCode(...t))})((r=n,'\n    <html xmlns:o="urn:schemas-microsoft-com:office:office"\n    xmlns:x="urn:schemas-microsoft-com:office:excel"\n    xmlns="http://www.w3.org/TR/REC-html40">\n    <head>\n    \x3c!--[if gte mso 9]>\n    <xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>\n    <x:Name>{worksheet}</x:Name>\n    <x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions>\n    </x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml>\n    <![endif]--\x3e\n    <meta charset="UTF-8"/>\n    </head><body><table border="1" style="border-collapse:collapse;">{table}</table></body></html>'.replace(/{(\w+)}/g,((e,t)=>r[t]))))};c.addEventListener("click",(()=>{const t=e.querySelectorAll(".selected");if(!t.length)return;const n=a.value,r=l.checked;t.forEach((e=>y(e,n,r)))})),r.addEventListener("click",(()=>B("table"))),d?.addEventListener("click",q),t.addEventListener("click",(()=>{const e=g("#number"),t=x("table")?m:g("#name");N(e,t),o.disabled=!0,b()})),u.forEach((e=>{const t=document.getElementById(e);t&&(t.addEventListener("change",q),t.addEventListener("input",q))})),n.addEventListener("click",(function(){const e=h();if(!e)return;const t=e.getElementsByTagName("tr");if(!t.length)return;const n=t[t.length-1].cloneNode(!0);n.querySelectorAll("td").forEach((e=>{const t=e.textContent.trim().toLowerCase();["remove","<",">"].includes(t)||(e.addEventListener("click",k),e.addEventListener("dblclick",f)),"remove"===t?e.addEventListener("click",C):"<"===t?e.addEventListener("click",I):">"===t&&e.addEventListener("click",w)})),e.appendChild(n)}));const W=E.getItem("tableData",null);W&&W.length>0?(()=>{const e=E.getItem("tableData",[]);e.length&&(e.forEach((e=>{const t=e[0]?.text||"",n=e.length-5;N(n,t);const r=h(),o=r.rows[r.rows.length-1];e.forEach(((e,t)=>{o.cells[t].textContent=e.text||"",t<o.cells.length-4&&e.selected&&o.cells[t].classList.add("selected")}))})),A(),q())})():""===e.innerHTML.trim()&&(N(g("#number"),m),o.disabled=!0)})();

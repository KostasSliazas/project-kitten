(()=>{"use strict";const e=document.querySelector("#main"),t=document.querySelector("#add"),n=document.querySelector("#clone"),r=document.querySelector("#export"),o=document.querySelector("#number"),l=document.getElementById("add-text-to-selected"),c=document.getElementById("break"),d=document.querySelector("#text"),a=new Date,s=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`,i=e=>document.querySelector(e).value,m=e=>{const t=document.getElementById(e);return 0===t.children.length&&""===t.textContent.trim()},u=(e,t="")=>{const n=document.createElement(e);return n.innerHTML=t,n},h=()=>{const e=document.getElementById("table"),t=e&&e.querySelectorAll("tr").length>0;n.disabled=!t},x=(e,t,n=!1)=>{n?e.dataset.breakAdded||(e.innerHTML+="<br>"+t,e.dataset.breakAdded="true"):(e.innerHTML=t,e.dataset.breakAdded="")},b=e=>{e.preventDefault();const t=d.value;if(""===t)return x(e.currentTarget,t,!1);x(e.currentTarget,t,c.checked)},g=e=>{e.preventDefault(),e.currentTarget.classList.toggle("selected"),L()},p=function(){this.parentElement.remove(),o.disabled=!m("table"),h()};let E=0;const f=()=>{const e=d.value,t=Number(e[0]);return E+=t,E%t==0?1:0},k=e=>{const[,...t]=e.parentElement.children;return t.length-=4,t},v=function(){const e=k(this);if(e.length<2)return;const t=e[e.length-1].innerText;for(let t=e.length-1;t>0;t--)e[t].innerText=e[t-1].innerText;e[0].innerText=t},y=function(){const e=k(this);if(e.length<2)return;const t=e[0].innerText;for(let t=0;t<e.length-1;t++)e[t].innerText=e[t+1].innerText;e[e.length-1].innerText=t},L=()=>{const e=document.getElementById("table");e&&Array.from(e.rows).forEach((e=>{const t=e.querySelectorAll("td.selected").length,n=e.querySelector('td[data-control="count"]');n&&(n.textContent=t)}))},T=(t,n)=>{let r=e.querySelector("table");r||(r=document.createElement("table"),r.id="table",r.cellPadding="0",r.cellSpacing="0",r.style.gridTemplateColumns=`repeat(${Number(t)+5}, minmax(20px, 1fr))`,e.appendChild(r));const o=document.createElement("tr"),l=document.createDocumentFragment(),c=u("td",(a=n)?a.charAt(0).toUpperCase()+a.slice(1):"");var a;c.addEventListener("dblclick",b),o.appendChild(c);const s=Number(t)>=28&&Number(t)<=31?Number(t):31,i=d.value;for(let e=1;e<=s;e++){let t=e<10?`0${e}`:e;i.includes("+")?t=f():i&&(t=i);const n=u("td",t);n.align="center",n.addEventListener("click",g),n.addEventListener("dblclick",b),o.appendChild(n)}[{text:"remove",control:"remove",handler:p},{text:"<",control:"prev",handler:y},{text:">",control:"next",handler:v},{text:"0",control:"count",handler:L}].forEach((({text:e,control:t,handler:n})=>{const r=u("td",e);r.dataset.control=t,r.style.cursor="pointer",r.style.textAlign="center",r.addEventListener("click",n),o.appendChild(r)})),l.appendChild(o),r.appendChild(l)},S=(e,t)=>{e.nodeType||(e=document.getElementById(e));const n={worksheet:t||"Worksheet",table:(e=>(Array.from(e.rows).forEach((e=>{Array.from(e.cells).forEach((e=>{const t=e.textContent.trim().toLowerCase();["remove","<",">"].includes(t)?e.remove():(e.setAttribute("valign","top"),e.classList.contains("selected")&&e.setAttribute("bgcolor","#777777"),"count"===e.dataset.control&&e.setAttribute("bgcolor","#eeeeee"))}))})),e))(e.cloneNode(!0)).innerHTML};var r;window.location.href="data:application/vnd.ms-excel;base64,"+(e=>{const t=(new TextEncoder).encode(e);return btoa(String.fromCharCode(...t))})((r=n,'\n    <html xmlns:o="urn:schemas-microsoft-com:office:office"\n    xmlns:x="urn:schemas-microsoft-com:office:excel"\n    xmlns="http://www.w3.org/TR/REC-html40">\n    <head>\n    \x3c!--[if gte mso 9]>\n    <xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>\n    <x:Name>{worksheet}</x:Name>\n    <x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions>\n    </x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml>\n    <![endif]--\x3e\n    <meta charset="UTF-8"/>\n    </head><body><table border="1" style="border-collapse:collapse;">{table}</table></body></html>'.replace(/{(\w+)}/g,((e,t)=>r[t]))))};l.addEventListener("click",(()=>{const t=e.querySelectorAll(".selected"),n=d.value,r=c.checked;t.length&&t.forEach((e=>{x(e,n,r)}))})),r.addEventListener("click",(()=>S("table"))),t.addEventListener("click",(()=>{const e=i("#number"),t=m("table")?s:i("#name");T(e,t),o.disabled=!0,h()})),n.addEventListener("click",(function(){const e=document.getElementById("table");if(!e)return;const t=e.getElementsByTagName("tr");if(!t.length)return;const n=t[t.length-1].cloneNode(!0);n.querySelectorAll("td").forEach((e=>{const t=e.textContent.trim().toLowerCase();["remove","<",">"].includes(t)||(e.addEventListener("click",g),e.addEventListener("dblclick",b)),"remove"===t?e.addEventListener("click",p):"<"===t?e.addEventListener("click",y):">"===t&&e.addEventListener("click",v)})),e.appendChild(n)})),""===e.innerHTML.trim()&&(T(i("#number"),s),o.disabled=!0)})();

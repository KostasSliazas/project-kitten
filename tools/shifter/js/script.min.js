(()=>{"use strict";const e=document.querySelector("#main"),t=document.querySelector("#add"),n=document.querySelector("#clone"),r=document.querySelector("#export"),o=document.querySelector("#number"),l=document.getElementById("add-text-to-selected"),c=new Date,d=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`,a=e=>document.querySelector(e).value,i=e=>{const t=document.getElementById(e);return 0===t.children.length&&""===t.textContent.trim()},s=(e,t="")=>{const n=document.createElement(e);return n.innerHTML=t,n},m=e=>{e.preventDefault(),e.currentTarget.classList.toggle("selected")},u=e=>{e.preventDefault(),e.currentTarget.innerText=a("#text")},x=function(){this.parentElement.remove(),o.disabled=!i("table")};let h=0;const g=()=>{const e=a("#text"),t=Number(e[0]);return h+=t,h%t==0?1:0},p=e=>{const[,...t]=e.parentElement.children;return t.length-=3,t},b=function(){const e=p(this);if(e.length<2)return;const t=e[e.length-1].innerText;for(let t=e.length-1;t>0;t--)e[t].innerText=e[t-1].innerText;e[0].innerText=t},f=function(){const e=p(this);if(e.length<2)return;const t=e[0].innerText;for(let t=0;t<e.length-1;t++)e[t].innerText=e[t+1].innerText;e[e.length-1].innerText=t},E=(t,n)=>{let r=e.querySelector("table");r||(r=document.createElement("table"),r.id="table",r.cellPadding="0",r.cellSpacing="0",r.style.gridTemplateColumns=`repeat(${Number(t)+4}, minmax(20px, 1fr))`,e.appendChild(r));const o=document.createElement("tr"),l=document.createDocumentFragment(),c=s("td",(d=n)?d.charAt(0).toUpperCase()+d.slice(1):"");var d;c.addEventListener("dblclick",u),o.appendChild(c);const i=Number(t)>=28&&Number(t)<=31?Number(t):31,h=a("#text");for(let e=1;e<=i;e++){let t=e<10?`0${e}`:e;h.includes("+")?t=g():h&&(t=h);const n=s("td",t);n.align="center",n.addEventListener("click",m),n.addEventListener("dblclick",u),o.appendChild(n)}[{text:"remove",handler:x},{text:"<",handler:f},{text:">",handler:b}].forEach((({text:e,handler:t})=>{const n=s("td",e);n.id=e,n.addEventListener("click",t),o.appendChild(n)})),l.appendChild(o),r.appendChild(l)},k=(e,t)=>{e.nodeType||(e=document.getElementById(e));const n=(e=>{e.nodeType||(e=document.getElementById(e));const t=e.cloneNode(!0);for(const e of Array.from(t.rows))for(const t of Array.from(e.cells)){const e=t.textContent.trim().toLowerCase();"remove"!==e&&"<"!==e&&"&lt;"!==e&&">"!==e&&"&gt;"!==e?(getComputedStyle(t).backgroundColor,t.className.includes("selected")&&t.setAttribute("bgcolor","#777777")):t.remove()}return t})(e),r={worksheet:t||"Worksheet",table:n.innerHTML};var o;window.location.href="data:application/vnd.ms-excel;base64,"+(e=>{const t=(new TextEncoder).encode(e);return btoa(String.fromCharCode(...t))})((o=r,'\n    <html xmlns:o="urn:schemas-microsoft-com:office:office"\n    xmlns:x="urn:schemas-microsoft-com:office:excel"\n    xmlns="http://www.w3.org/TR/REC-html40">\n    <head>\n    \x3c!--[if gte mso 9]>\n    <xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>\n    <x:Name>{worksheet}</x:Name>\n    <x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions>\n    </x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml>\n    <![endif]--\x3e\n    <meta charset="UTF-8"/>\n    </head>\n    <body>\n    <table border="1" style="border-collapse:collapse;">{table}</table>\n    </body>\n    </html>'.replace(/{(\w+)}/g,((e,t)=>o[t]))))};l.addEventListener("click",(()=>{const t=e.querySelectorAll(".selected"),n=a("#text");t.forEach((e=>e.innerText=n))})),r.addEventListener("click",(()=>k("table"))),t.addEventListener("click",(()=>{const e=a("#number"),t=i("table")?d:a("#name");E(e,t),o.disabled=!0})),n.addEventListener("click",(function(){const e=document.getElementById("table");if(!e)return;const t=e.getElementsByTagName("tr");if(!t.length)return;const n=t[t.length-1].cloneNode(!0);n.querySelectorAll("td").forEach((e=>{const t=e.textContent.trim().toLowerCase();["remove","<",">"].includes(t)||(e.addEventListener("click",m),e.addEventListener("dblclick",u)),"remove"===t?e.addEventListener("click",x):"<"===t?e.addEventListener("click",f):">"===t&&e.addEventListener("click",b)})),e.appendChild(n)})),""===e.innerHTML.trim()&&(E(a("#number"),d),o.disabled=!0)})();
